<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Troubleshooting &#8212; i-PI 3.0.0-alpha2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/agogo.css?v=3ace793a" />
    <link rel="stylesheet" type="text/css" href="_static/custom_styles.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=a69af3ce"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="Frequently asked questions" href="faq.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
          <p class="logo"><a href="index.html">
            <img class="logo" src="_static/ipi-logo.svg" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="index.html">i-PI 3.0.0-alpha2 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="faq.html" title="Frequently asked questions"
             accesskey="P">previous</a> |
          <a href="contributing.html" title="Contributing"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Core features</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Internal units and conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-files.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-tags.html">Input file tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-tags.html">Output file tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">Distributed execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">A simple tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#input-errors">Input errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialization-errors">Initialization errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-errors">Output errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#socket-errors">Socket errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mathematical-errors">Mathematical errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-pi-is-slow">I-PI is slow!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>

        </div>
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h1>
<section id="input-errors">
<h2>Input errors<a class="headerlink" href="#input-errors" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><em>not well-formed (invalid token)</em>: Seen if the input file does not
have the correct xml syntax. Should be accompanied by a line number
giving the point in the file where the syntax is incorrect.</p></li>
<li><p><em>mismatched tag</em>: One of the closing tags does not have the same name
as the corresponding opening tag. Could be caused either by a
misspelling of one of the tags, or by having the closing tag in the
wrong place. This last one is a standard part of the xml syntax, if
the opening tag of one item is after the opening tag of a second,
then its closing tag should be before the closing tag of the second.
Should be accompanied by a line number giving the position of the
closing tag.</p></li>
<li><p><em>Uninitialized value of type __</em> or <em>Attribute/Field name __ is
mandatory and was not found in the input for property __</em>: The xml
file is missing a mandatory tag, i.e. one without which the
simulation cannot be initialized. Find which tag name is missing and
add it.</p></li>
<li><p><em>Attribute/tag name __ is not a recognized property of __
objects</em>: The first tag should not be found within the second set of
tags. Check that the first tag is spelt correctly, and that it has
been put in the right place.</p></li>
<li><p><em>__ is not a valid option (___)</em>: This attribute/tag only allows a
certain range of inputs. Pick one of the items from the list given.</p></li>
<li><p><em>__ is an undefined unit for kind __</em> or <em>__ is not a valid
unit prefix</em> or <em>Unit __ is not structured with a prefix+base
syntax</em>: The unit input by the user is not correct. Make sure it
corresponds to the correct dimensionality, and is spelt correctly.</p></li>
<li><p><em>Invalid literal for int() with base 10: __</em> or <em>Invalid literal
for float(): __</em> or <em>__ does not represent a bool value</em>: The
data input by the user does not have the correct data type. See
section <a class="reference internal" href="input-files.html#ifilestructure"><span class="std std-ref">Input file format and structure</span></a> for what constitutes a valid
integer/float/boolean value.</p></li>
<li><p><em>Error in list syntax: could not locate delimiters</em>: The array input
data did not have the required braces. For a normal array use [], for
a dictionary use {}, and for a tuple use ().</p></li>
<li><p><em>The number of atom records does not match the header of xyz file</em>:
Self-explanatory.</p></li>
<li><p><em>list index out of range</em>: This will normally occur if the
configuration is initialized from an invalid input file. This will
either cause the code to try to read part of the input file that does
not exist, or to set the number of beads to zero which causes this
error in a different place. Check that the input file has the correct
syntax.</p></li>
</ul>
</section>
<section id="initialization-errors">
<h2>Initialization errors<a class="headerlink" href="#initialization-errors" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><em>Negative __ parameter specified.</em>: Self-explanatory.</p></li>
<li><p><em>If you are initializing cell from cell side lengths you must pass
the ’cell’ tag an array of 3 floats</em>: If you are attempting to
initialize a cell using the “abc” mode, the code expects three floats
corresponding to the three side lengths.</p></li>
<li><p><em>If you are initializing cell from cell side lengths and angles you
must pass the ’cell’ tag an array of 6 floats</em>: If you are attempting
to initialize a cell using the “abcABC” mode, the code expects six
floats corresponding to the three side lengths, followed by the three
angles in degrees.</p></li>
<li><p><em>Cell objects must contain a 3x3 matrix describing the cell
vectors.</em>: If you are attempting to initialize a cell using the
“manual” mode, the code expects nine floats corresponding to the cell
vector matrix side lengths. Note that the values of the
lower-diagonal elements will be set to zero.</p></li>
<li><p><em>Array shape mismatch in q/p/m/names in beads input</em>: The size of the
array in question does not have the correct number of elements given
the number of atoms and the number of beads used in the rest of the
input. If the number of beads is nbeads and the number of atoms
natoms, then q and p should have shape (nbeads, 3*natoms) and m and
names should have shape (natoms,).</p></li>
<li><p><em>No thermostat/barostat tag provided for NVT/NPT simulation</em>: Some
ensembles can only be sampled if a thermostat and/or barostat have
been defined, and so for simulations at constant temperature and/or
pressure these tags are mandatory. If you wish to not use a
thermostat/barostat, but still want to keep the ensemble the same,
then use “dummy” mode thermostat/barostat, which simply does nothing.</p></li>
<li><p><em>Pressure/Temperature should be supplied for constant
pressure/temperature simulation</em>: Since in this case the ensemble is
defined by these parameters, these must be input by the user. Add the
appropriate tags to the input file.</p></li>
<li><p><em>Manual path mode requires (nbeads-1) frequencies, one for each
internal mode of the path.</em>: If the “mode” tag of “normal_modes” is
set to “manual”, it will expect an array of frequencies, one for each
of the internal normal modes of the ring polymers.</p></li>
<li><p><em>PA-CMD mode requires the target frequency of all the internal
modes.</em>: If the “mode” tag of “normal_modes” is set to “pa-cmd”, it
will expect an array of one frequency, to which all the internal
modes of the ring polymers will be set.</p></li>
<li><p><em>WMAX-CMD mode requires [wmax, wtarget]. The normal modes will be
scaled such that the first internal mode is at frequency wtarget and
all the normal modes coincide at frequency wmax.</em>: If the “mode” tag
of “normal_modes” is set to “wmax-cmd”, it will expect an array of
two frequencies, one two set the lowest frequency normal mode, and
one for the other normal mode frequencies.</p></li>
<li><p><em>Number of beads __ doesn’t match GLE parameter nb= __</em>: The
matrices used to define the generalized Langevin equations of motion
do not have the correct first dimension. If matrices have been
downloaded from <a class="reference external" href="http://lab-cosmo.github.io/gle4md/">http://lab-cosmo.github.io/gle4md/</a>
make sure that you have input the correct number of beads.</p></li>
<li><p><em>Initialization tries to match up structures with different atom
numbers</em>: If in the initialization any of the matrices has an array
shape which do not correspond to the same number of atoms, then they
cannot correspond to the same system. Check the size of the arrays
specified if they have been input manually.</p></li>
<li><p><em>Cannot initialize single atom/bead as atom/bead index __ is
larger than the number of atoms/beads</em>: Self-explanatory. However,
note that indices are counted from 0, so the first replica/atom is
defined by an index 0, the second by an index 1, and so on.</p></li>
<li><p><em>Cannot initialize the momenta/masses/labels/single atoms before the
size of the system is known.</em>: In the code, a beads object is created
to hold all the information related to the configuration of the
system. However, until a position vector has been defined, this
object is not created. Therefore, whichever arrays are being
initialized individually, the position vector must always be
initialized first.</p></li>
<li><p><em>Trying to resample velocities before having masses.</em>: A
Maxwell-Boltzmann distribution is partly defined by the atomic
masses, and so the masses must be defined before the velocities can
be resampled from this distribution.</p></li>
<li><p><em>Cannot thermalize a single bead</em>: It does not make sense to
initialize the momenta of only one of the beads, and so i-PI does not
give this functionality.</p></li>
<li><p><em>Initializer could not initialize __</em>: A property of the system
that is mandatory to properly run the simulation has not been
initialized in either the “initialize” section or the appropriate
section in beads.</p></li>
<li><p><em>Ensemble does not have a thermostat to initialize</em> or <em>There is
nothing to initialize in non-GLE thermostats</em> or <em>Checkpoint file
does not contain usable thermostat data</em>: These are raised if the
user has tried to initialize the matrices for the GLE thermostats
with a checkpoint file that either does not have a GLE thermostat or
does not have a thermostat at all.</p></li>
<li><p><em>Size mismatch in thermostat initialization data</em>: Called if the
shape of the GLE matrices defined in the checkpoint file is different
from those defined in the new simulation.</p></li>
<li><p><em>Replay can only read from PDB or XYZ files – or a single frame from
a CHK file</em>: If the user specifies a replay ensemble, the state of
the system must be defined by either a configuration file or a
checkpoint file, and cannot be specified manually.</p></li>
</ul>
</section>
<section id="output-errors">
<h2>Output errors<a class="headerlink" href="#output-errors" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><em>The stride length for the __ file output must be positive.</em>:
Self-explanatory</p></li>
<li><p><em>__ is not a recognized property/output trajectory</em>: The string as
defined in the “properties”/”trajectory” tag does not correspond to
one of the available trajectories. Make sure that both the syntax is
correct, and that the property has been spelt correctly.</p></li>
<li><p><em>Could not open file __ for output</em>: Raised if there is a problem
opening the file defined by the “filename” attribute.</p></li>
<li><p><em>Selected bead index __ does not exist for trajectory __</em>: You
have asked for the trajectory of a bead index greater than the number
of the replicas of the system. Note that indices are counted from 0,
so the first replica is defined by an index 0, the second by an index
1, and so on.</p></li>
<li><p><em>Incorrect format in unit specification __</em>: Usually raised if one
of the curly braces has been neglected.</p></li>
<li><p><em>Incorrect format in argument list __</em>: This will be raised either
if one of the brackets has been neglected, or if the delimiters
between arguments, in this case “;”, are not correct. This is usually
raised if, instead of separating the arguments using “;”, they are
instead separated by “,”, since this causes the property array to be
parsed incorrectly.</p></li>
<li><p><em>__ got an unexpected keyword argument __</em>: This will occur if
one of the argument lists of one of the properties specified by the
user has a keyword argument that does not match any of those in the
function to calculate it. Check the properties.py module to see which
property this function is calculating, and what the correct keyword
arguments are. Then check the “properties” tag, and find which of the
arguments has been misspelt.</p></li>
<li><p><em>Must specify the index of atom_vec property</em>: Any property which
prints out a vector corresponding to one atom needs the index of that
atom, as no default is specified.</p></li>
<li><p><em>Cannot output __ as atom/bead index __ is larger than the
number of atoms/beads</em>: Self-explanatory. However, note that indices
are counted from 0, so the first replica/atom is defined by an index
0, the second by an index 1, and so on.</p></li>
<li><p><em>Couldn’t find an atom that matched the argument of __</em>: For
certain properties, you can specify an atom index or label, so that
the property is averaged only over the atoms that match it. If
however no atom labels match the argument given, then the average
will be undefined. Note that for properties which are cumulatively
counted rather than averaged, this error is not raised, and if no
atom matches the label given 0 will be returned.</p></li>
</ul>
</section>
<section id="socket-errors">
<h2>Socket errors<a class="headerlink" href="#socket-errors" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><em>Address already in use</em>: This is called if the server socket is
already being used by the host network. There are several possible
reasons for getting this error. Firstly, it might simply be that two
simulations are running concurrently using the same host and port
number. In this case simply change the port number of one of the
simulations. Secondly, you can get this error if you try to rerun a
simulation that previously threw an exception, since it takes a
minute or so before the host will disconnect the server socket if it
is not shut down cleanly. In this case, simply wait for it to
disconnect, and try again. Finally, you will get this error if you
try to use a restricted port number (i.e. below 1024) while not root.
You should always use a non-restricted port number for i-PI
simulations.</p></li>
<li><p><em>Error opening unix socket. Check if a file /tmp/ipi___ exists, and
remove it if unused.</em>: Similar to the above error, but given if you
are using a unix socket rather than an internet socket. Since this
binds locally the socket can be removed by the user, which means that
it is not necessary to wait for the computer to automatically
disconnect an unused server socket.</p></li>
<li><p><em>Port number __ out of acceptable range</em>: The port number must be
between 1 and 65535, and should be greater than 1024. Change the port
number accordingly.</p></li>
<li><p><em>Slot number __ out of acceptable range</em>: The slot number must be
between 1 and 5. Change the slot number accordingly.</p></li>
<li><p><em>’NoneType’ object has no attribute ’Up’</em>: This is called if an
exception is raised during writing the data to output, and so the
thread that deals with the socket is terminated uncleanly. Check the
stack trace for the original exception, since this will be the actual
source of the problem. Also note that, since the socket thread was
not cleaned up correctly, the server socket may not have been
disconnected properly and you may have to wait for a minute before
you can restart a simulation using the same host and port number.</p></li>
</ul>
</section>
<section id="mathematical-errors">
<h2>Mathematical errors<a class="headerlink" href="#mathematical-errors" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><em>math domain error</em>: If the cell parameters are defined using the
side lengths and angles, with either a pdb file or using the “abcABC”
initialization mode, then for some value of the angles it is
impossible to construct a valid cell vector matrix. This will cause
the code to attempt to take the square root of a negative number,
which gives this exception.</p></li>
<li><p><em>overflow encountered in exp</em>: Sometimes occurs in <em>NPT</em> runs when
the simulation box “explodes”. Make sure you have properly
equilibrated the system before starting and that the timestep is
short enough to not introduce very large integration errors.</p></li>
</ul>
</section>
<section id="i-pi-is-slow">
<h2>I-PI is slow!<a class="headerlink" href="#i-pi-is-slow" title="Permalink to this heading">¶</a></h2>
<p>i-PI is not designed to be highly efficient, but it should not be the
bottleneck in your calculations. Most of the time, if you see a major
slow-down, there is a problem with your setup. Here are some tricks
you can try.</p>
<ul class="simple">
<li><p><em>use a UNIX domain socket</em>: if you run on a single node, it is much
faster to use <cite>mode=”unix”</cite> in your <cite>&lt;ffsocket&gt;</cite> classes. This uses
a shared-memory communication process, that avoids much of the
network latency of a TCP/IP socket.</p></li>
<li><p><em>reduce latency</em>: if you have a VERY fast forcefield (with force
evaluation below ~1ms) it might help to set the <cite>&lt;latency&gt;</cite> parameter
of <cite>&lt;ffsocket&gt;</cite> to a small value, 1e-4s or less</p></li>
<li><p><em>reduce I/O</em>: outputting hundreds of beads configurations at each time
step is going to be slow in any scenario, but particularly so when
using text files and Python. Reduce the output frequency using a larger
<cite>stride</cite>, and/or <cite>flush</cite> less often.</p></li>
<li><p><em>reduce the stride of internal checkpoints</em>: to guarantee that soft
exits leave the simulation in a state that can be restarted safely,
i-PI stores the internal state of the simulation at each step.
Particularly for complicated setups, the overhead can be substantial.
You can reduce the frequency by which the internal state is stored using
the <cite>safe_stride</cite> attribute in the <cite>&lt;simulation&gt;</cite> tag. Note that doing
so increases the risk that the RESTART file saved upon soft exit will be
inconsistent with the sate of the outputs, so that restarting a simulaiton
will leave broken or discontinuous output files.</p></li>
<li><p><em>profile i-PI</em>: if you still think i-PI is being unreasonably slow,
you can contact the developers - your setup might have revealed some
kind of bottleneck. It will help us if you can also generate a profiler
output from your run (possibly with only a small number of steps).
You can generate a profiler log by running i-PI with <cite>-p</cite> option,
e.g. <cite>i-pi -p input.xml</cite>.
You will need to install the <cite>yappi</cite> profiler.</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="faq.html" title="Frequently asked questions"
              >previous</a> |
            <a href="contributing.html" title="Contributing"
              >next</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/troubleshooting.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
    &#169; Copyright 2021, The i-PI developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>